name: Build and Deploy My Blog
on:
  push:
    branches:
      - master  # 触发分支，根据你的主分支名称修改（如 master）

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # 允许工作流推送代码

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # 获取完整历史记录

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: 20  # 推荐使用 LTS 版本

    - name: Build Vitepress
      run: |
          rm -rf node_modules
          rm pnpm-lock.yaml
          rm npm-lock.yaml
          npm i
          npm run build

    - name: Deploy 
      uses: JamesIves/github-pages-deploy-action@4.1.5
      with:
          branch: release
          folder: docs/.vitepress/dist
          token: ${{ secrets.ACCESS_TOKEN }}
          repository-name: lijiapeng001/lijiapeng001.github.io # github page 仓库