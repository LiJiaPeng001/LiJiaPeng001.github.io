---
layout: doc
title: HTTP
---

# HTTP 相关基础

## 在地址栏里输入一个地址回车会发生哪些事情

- 解析 URL：首先会对 URL 进行解析，分析所需要使用的传输协议和请求的资源的路径。
- 缓存判断：浏览器会判断所请求的资源是否在缓存里，如果请求的资源在缓存里并且没有失效，那么就直接使用，否则向服务器发起新的请求。
- DNS 解析： 下一步首先需要获取的是输入的 URL 中的域名的 IP 地址，首先会判断本地是否有该域名的 IP 地址的缓存，如果有则使用，如果没有则向本地 DNS 服务器发起请求。
- TCP 三次握手： 下面是 TCP 建立连接的三次握手的过程，首先客户端向服务器发送一个 SYN 连接请求报文段和一个随机序号，服务端接收到请求后向客户端发送一个 SYN ACK 报文段，确认连接请求，并且也向客户端发送一个随机序号。客户端接收服务器的确认应答后，进入连接建立的状态，同时向服务器也发送一个 ACK 确认报文段，服务器端接收到确认后，也进入连接建立状态，此时双方的连接就建立起来了。
- HTTPS 握手： 如果使用的是 HTTPS 协议，在通信前还存在 TLS 的一个四次握手的过程。
- 返回数据： 当页面请求发送到服务器端后，服务器端会返回一个 html 文件作为响应，浏览器接收到响应后，开始对 html 文件进行解析，开始页面的渲染过程。
- 页面渲染： 浏览器首先会根据 html 文件构建 DOM 树，根据解析到的 css 文件构建 CSSOM 树，如果遇到 script 标签，则判端是否含有 defer 或者 async 属性，要不然 script 的加载和执行会造成页面的渲染的阻塞。当 DOM 树和 CSSOM 树建立好后，根据它们来构建渲染树。渲染树构建好后，会根据渲染树来进行布局。布局完成后，最后使用浏览器的 UI 接口对页面进行绘制。这个时候整个页面就显示出来了。
- TCP 四次挥手： 最后一步是 TCP 断开连接的四次挥手过程。

## HTTP 中的强缓存与协商缓存

#### 强缓存分为`expires`（http1.0 规范）、 `cache-control`（http1.1 规范）两种。

expires 是根据本地时间来判断的，假设客户端和服务器时间不同，会导致缓存命中误差

在 http1.1 规范中，提出了`cache-control`字段，且这个字段优先级高于上面提到的`Expires`，值是相对时间。

#### 协商缓存

协商缓存（也叫对比缓存）是由服务器来确定资源是否可用.
